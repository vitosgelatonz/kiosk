<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Vito's Gelato ‚Äì Kiosk</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg-main: #f4efea;
      --card-bg: #ffffff;
      --accent: #077791;
      --accent-soft: #dfdbd2;
      --danger: #c62828;
      --success: #2e7d32;
      --text-main: #333333;
      --text-soft: #777777;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, sans-serif; background: var(--bg-main); color: var(--text-main); font-size: 18px; }
    .app { max-width: 1500px; margin: 0 auto; padding: 12px; }
    .sections { display: grid; grid-template-columns: 0.36fr 0.64fr; gap: 12px; align-items: start; }

    section { background: var(--accent-soft); border-radius: 12px; padding: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.08); }
    section h2 {
      background: var(--accent); color: white; padding: 10px 14px; margin: -10px -10px 10px -10px;
      border-radius: 10px 10px 0 0; display: flex; align-items: center; justify-content: space-between;
      font-size: 1.05rem; font-weight: 600;
    }

    .payment-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    /* Notes button */
    #notes-btn {
      background:#e0c58a;
      border:none;
      border-radius:50%;
      width:34px;
      height:34px;
      font-size:18px;
      cursor:pointer;
      flex-shrink:0;
    }

    /* Inline Notes Box */
    #notes-box {
      display:none;
      margin-top:10px;
      background:white;
      padding:10px;
      border-radius:10px;
      box-shadow:0 2px 6px rgba(0,0,0,0.1);
      display:none;
      flex-direction:column;
      gap:8px;
    }
    #notes-input {
      width:100%;
      height:80px;
      border-radius:8px;
      border:1px solid #ccc;
      padding:8px;
      font-size:1rem;
    }
    #finish-notes {
      background:var(--accent);
      color:white;
      border:none;
      padding:8px 12px;
      border-radius:8px;
      font-size:1rem;
      cursor:pointer;
      width:120px;
      align-self:flex-end;
    }

    /* (rest of your existing styles unchanged) */

    .row { display: flex; align-items: center; justify-content: space-between; margin: 6px 0; }
    .label { font-size: 0.95rem; }
    .price { font-size: 0.8rem; color: var(--text-soft); margin-left: 6px; }
    .controls { display: flex; align-items: center; gap: 6px; }

    button.btn {
      border: none; border-radius: 999px; padding: 6px 12px;
      font-size: 1.2rem; cursor: pointer; min-width: 40px;
      display: flex; align-items: center; justify-content: center;
    }
    .btn-plus { background: var(--success); color: #fff; }
    .btn-minus { background: var(--danger); color: #fff; }

    .count { min-width: 32px; text-align: center; font-weight: 700; font-size: 1.05rem; }

    .flavour-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(155px, 1fr));
      gap: 10px; max-height: 650px; overflow-y: auto; padding-right: 4px;
    }

    .flavour-card { background: #ffffff; border: 2px solid transparent; border-radius: 16px; padding: 8px; box-shadow: 0 1px 4px rgba(0,0,0,0.06); display:flex; flex-direction:column; justify-content:space-between; }

    .summary { margin-top: 6px; font-size: 0.85rem; line-height: 1.4; color: var(--text-soft); min-height: 40px; }

    .bottom-bar {
      position: sticky; bottom: 0; background: rgba(244,239,234,0.98);
      padding: 8px 4px; border-top: 1px solid rgba(0,0,0,0.05);
      display:flex; align-items:center;
    }
  </style>
</head>

<body>
<div class="app">
<div class="sections">
  
  <div>
    <!-- CUSTOMER SECTION -->
    <section id="customer-section">
      <h2>Customer Type <span>Adults, kids, online</span></h2>
    </section>

    <!-- ORDER SIZE SECTION -->
    <section id="size-section">
      <h2>Order Size <span>Price per item</span></h2>
    </section>

    <!-- PAYMENT SECTION -->
    <section id="payment-section">
      <h2>Payment & Summary <span>Payment method</span></h2>

      <!-- Payment header row with notes button -->
      <div class="payment-header-row">
        <div class="payment-options">
          <label><input type="radio" name="payment" value="card" checked> Card</label>
          <label><input type="radio" name="payment" value="cash"> Cash</label>
          <label><input type="radio" name="payment" value="mixed"> Mixed</label>
        </div>

        <button id="notes-btn">üìù</button>
      </div>

      <!-- Inline notes box -->
      <div id="notes-box">
        <textarea id="notes-input" placeholder="Enter notes..."></textarea>
        <button id="finish-notes">Finish</button>
      </div>

      <!-- Mixed fields -->
      <div id="mixed-fields" style="display:none;">
        <div>
          <label>Card Amount:</label>
          <input type="number" id="card-input" min="0" step="0.10">
        </div>
        <div>
          <label>Cash Amount:</label>
          <strong id="cash-output">$0.00</strong>
        </div>
      </div>

      <div class="summary" id="summary-box"></div>
    </section>

    <!-- Accessories Section -->
    <section id="accessories-section" style="padding-top: 8px;">
      <div class="row" style="justify-content:flex-start; gap:40px; margin-top:0;">
        <div style="display:flex; align-items:center; gap:6px;">
          <div class="label">Cones</div>
          <div class="controls">
            <button class="btn btn-minus" data-type="accessory" data-key="cones" data-delta="-1">‚àí</button>
            <span class="count" id="accessory-cones">0</span>
            <button class="btn btn-plus" data-type="accessory" data-key="cones" data-delta="1">+</button>
          </div>
        </div>

        <div style="display:flex; align-items:center; gap:6px;">
          <div class="label">Cups</div>
          <div class="controls">
            <button class="btn btn-minus" data-type="accessory" data-key="cups" data-delta="-1">‚àí</button>
            <span class="count" id="accessory-cups">0</span>
            <button class="btn btn-plus" data-type="accessory" data-key="cups" data-delta="1">+</button>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- FLAVOURS -->
  <section id="flavour-section">
    <h2>Flavours <span>Tap to add or remove</span></h2>
    <div class="flavour-grid" id="flavour-grid"></div>
  </section>

</div>

<!-- Bottom bar -->
<div class="bottom-bar">
  <div class="total" id="total-box">Total: $0.00</div>
  <div style="flex:1; text-align:center;"><span id="saving-indicator">Saving‚Ä¶</span></div>
  <div class="bottom-buttons">
    <button class="action cancel" id="cancel-btn">Cancel</button>
    <button class="action done" id="done-btn">Done</button>
  </div>
</div>

</div>

<script>
// ------------------------------------------------------------------
// DATA
// ------------------------------------------------------------------

const state = {
  customers:{}, sizes:{}, flavours:{},
  cones:0, cups:0,
  payment:"card",
  cardAmount:0,
  notes:""
};

// (Your flavour data, customer types, sizes, etc remain unchanged)

// ------------------------------------------------------------------
// NOTES FUNCTIONALITY
// ------------------------------------------------------------------

const notesBtn = document.getElementById("notes-btn");
const notesBox = document.getElementById("notes-box");
const notesInput = document.getElementById("notes-input");
const finishNotes = document.getElementById("finish-notes");

notesBtn.addEventListener("click", () => {
  notesInput.value = state.notes;
  notesBox.style.display = "flex";
});

finishNotes.addEventListener("click", () => {
  state.notes = notesInput.value.trim();
  notesBox.style.display = "none";
});

// ------------------------------------------------------------------
// WHEN SUBMITTING ORDER ‚Üí INCLUDE NOTES
// ------------------------------------------------------------------

async function submitOrder() {
  const total = calcTotal();
  if (total === 0) { alert("No sizes selected."); return; }

  const payload = {
    timestamp: getLocalTimestamp(),
    customers: state.customers,
    sizes: state.sizes,
    flavours: state.flavours,
    cones: state.cones,
    cups: state.cups,
    payment: state.payment,
    cardAmount: state.cardAmount,
    notes: state.notes,    // ‚≠ê INCLUDED
    total: total
  };

  await fetch(GOOGLE_SCRIPT_URL, {
    method:"POST",
    mode:"no-cors",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ row:payload })
  });

  resetAll();
  showPopup();
}

// ------------------------------------------------------------------
// RESET NOTES ON CANCEL
// ------------------------------------------------------------------

function resetAll() {
  state.notes = "";
  notesInput.value = "";
  notesBox.style.display = "none";
  
  // (rest of your reset logic unchanged)
}

</script>
</body>
</html>
